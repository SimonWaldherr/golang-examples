# gomock example
[gomock](https://github.com/golang/mock) is a mocking framework that allows you to replace network calls with mocked network calls in your tests.

## File Structure
- gomock_example: The core functionality of this package.
- client.go: Contains the example API client that will be mocked. 
- gomock_example_test: the test code implementing `gomock`.


## Running this Example
```
$ go get
$ go test .
```
Gomock relies on files generated by `mock.go`. These files use interfaces that you define.

The key to setting up mocking is to write interfaces for your objects that are making network calls.

In this example, I created a `client.go` file with the following content
```go
type ApiClient interface {
	// When called, the API is expected to double the provided value
	ApiDouble(valueToDouble int) (int, error)
}
```

This is a simple example of an client that makes a network call during its execution. For simplicity, there is no network call here, but the idea is the same. We can imagine that `ApiDouble` hits some external service to perform its operation. 

In order to generate our mocked code, we first install `mockgen` with
```
# Assumes Go 1.16+
go install github.com/golang/mock/mockgen@v1.6.0
```
Then, from the root of our project run
```
mockgen -source client.go mock.go > mock.go
```
Now we have mock code that we can use. It will auto-generate the code we need to create a mock client `NewMockApiClient`. The result of this function is passed into our server when we create it in our test. 

```go
func getMockServer(t *testing.T) (*Server, *MockApiClient, *gomock.Controller) {
	ctrl := gomock.NewController(t)
	cli := NewMockApiClient(ctrl)
	server := &Server{
		Client: cli,
	}
	return server, cli, ctrl
}
```

Anywhere that this server uses its `Client`, it will use the mock client instead. 

### More Information
- [Mocking Wikipedia Page](https://en.wikipedia.org/wiki/Mock_object)
- [gomock repo](https://github.com/golang/mock)